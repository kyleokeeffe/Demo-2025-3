@using demo2025_razor.ViewModels
@using demo2025_razor.ViewModels.PageModels
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    ViewData["Title"] = "Quotes";
}
@model QuotesPageViewModel



<h1>@ViewData["Title"]</h1>

<p>Use this page to detail your site's privacy policy.</p>
<label>User: @Model.Customer.FullName</label>
<br />
<label>Role: @Model.Customer.Role</label>


<div id="quotesTableContainer">
    @await Html.PartialAsync("~/Views/Home/Quotes/_QuotesTable.cshtml", Model.Quotes)
</div>
<div>
    <button id="btnAddNewQuote" onclick="onAddNewQuoteClicked">Add Quote</button>
    <input type="text" id="txtNewQuoteName" />
</div>
<div id="productsTableContainer">


</div>


@section Scripts{
    <script>
        $(document).ready(function(){
            initializeQuoteDataTable();
            
        });

        function initializeQuoteDataTable(){
                  $('#tblQuotes').DataTable({
                paging: true,
                destroy: true
            });
        }
        function onAddNewQuoteClicked(){
            //show modal
           var txtVal = $(txtNewQuoteName).val();
           AddNewQuote(txtVal);

        }
        function AddNewQuote(txtVal) {
            // Logic to add a new quote
             $.ajax({
                url: '@Url.Action("AddNewQuote", "Home")',
                type: 'POST',
                data: { name: txtVal},
                success: function (R) {
                    console.log('succeeded');
                    if (R.success == true) {
                        console.log('success');
                        refreshQuotesTable(R.quotes);
                    } else if (R.success == false) {
                        console.log('failed: ' + R.message);
                        //$('[data-product-id="' + id + '"]').prop('checked', !isActive);
                    }
                },
                error: function (R) {
                    console.log('failed: ' + R.message);
                    $('[data-product-id="' + id + '"]').prop('checked', !isActive);
                }
            });


            console.log("Add New Quote button clicked");
            // You can implement the logic to open a modal or redirect to a new page for adding a quote
        }

         function refreshQuotesTable() {
            $.ajax({
                url: '@Url.Action("GetQuotesTableData", "Home")',
                type: 'GET',
                success: function (data) {
                    $('#quotesTableContainer').html(data);
                    initializeQuoteDataTable();
                },
                error: function () {
                    console.log('Failed to refresh table data');
                }
            });
        }
        function refreshQuotesTable(data) {
           
            $('#quotesTableContainer').html(data);
            initializeQuoteDataTable();
               
            
        }

  
        
    </script>
}